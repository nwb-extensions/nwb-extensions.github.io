---
title: "NDX Sharing Strategies"
layout: default
excerpt: "NDX Sharing Strategies"
sitemap: false
permalink: /ndx_sharing_strategies
---

# Strategies for sharing NWB:N extensions (NDX)

* Version: 0.3.0 (DRAFT)
* Authors:
   * Oliver Ruebel
   * Andrew Tritt
   * Benjamin Dichter
   * Ryan Ly
* Last update: April 23, 2019

## 1. Overview

The purpose of this document is to define standard practices and strategies for sharing NWB:N extensions (NDX).

### 1.1 Definitions

* The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt).
* **“Neurodata Extension” (NDX)** refers to an extension to the NWB:N data standard.  An NDX MUST be described by a formal format specification using the NWB:N specification language.
* **“Internal NDX”** refers to extensions used within a particular lab, organization or project that are not intended for use outside of the particular organization.
* **“Public NDX”** refers to extensions intended for use by the public (or specific larger community).
* **“nwb-extensions”** refers to the public catalog for NDX. The nwb-extensions catalog is implemented via a dedicated public GitHub organization at [https://github.com/nwb-extensions](https://github.com/nwb-extensions)
* **“ndx-template”** repository refers to the code repository used to manage the sources of the extension
   * **“ndx-custom>”** refers to a specific user extension repository that has usually been created from the ndx-template. This repository lives in the users own Git space and is NOT part of the nwb-extensions organization.
* **“staged-extensions”** repository refers to the template Git repository as part of the NDX catalog used to register the extension with the catalog (this includes basic metadata about the NDX and information needed for install and deployment).
    * **“ndx-custom-recipe”** refers to a specific recipe for deploying a particular extension. This repo is also part of the “nwb-extensions” GitHub organization. This repo should be automatically generated by the CI of the staged-extensions repo
    **“user/ndx-custom-recipe”** refers to the users fork of the ndx-custom-recipe repo. This repo lives in the users Git space (NOT in nwb-extensions)

### 1.2 Summary

NWB:N defines a set of <a href="{{ site.url }}{{ site.baseurl }}/versioning_guidelines">Versioning Guidelines</a> for versioning extension namespaces and  <a href="{{ site.url }}{{ site.baseurl }}/ndx_sharing_guideline">NDX Sharing Guidelines</a> that public NDX MUST follow and internal NDXs are highly RECOMMENDED to follow. In order to help ensure compliance with these rules NWB:N provides a number of tools, templates, and guidelines.

## 2. Methods and tools for sharing extensions

### 2.1 [nwb-extensions](https://github.com/nwb-extensions): Extensions GitHub Organization

NDX should be shared via a dedicated [nwb-extensions](https://github.com/nwb-extensions) GitHub organization. The NDX catalog provides the ndx-template and staged-extensions extension template repositories (see below) as well as all public ndx-custom-recipe repositories. In this way, all public extensions are managed in one place and MUST follow the same basic internal organization. This also avoids cluttering up the regular [Neurodata Without Borders GitHub organization](https://github.com/NeurodataWithoutBorders). Finally, this strategy allows for labs/universities/independent-groups to maintain the ndx-template source code repository in their own GitHub organization. The ability to do so, can be important in particular when the developers of the extension are funded by their own grants and/or are applying for funding.

#### 2.1.1 [ndx-template](https://github.com/nwb-extensions/ndx-template): Extension template

The [ndx-template](https://github.com/nwb-extensions/ndx-template) provides a standard Git template repository with a standard setup for creating and sharing extensions and instructions for how to use the template. Using [Cookiecutter](https://cookiecutter.readthedocs.io/en/latest/), users can easily modify the template to create the basic setup for their ndx-template repository. See the [ndx-template](https://github.com/nwb-extensions/ndx-template) repository for details on the organization of template.

#### 2.1.2 [staged-extensions](https://github.com/nwb-extensions/staged-extensions): Creating custom ndx recipes

The [staged-extensions](https://github.com/nwb-extensions/staged-extensions) repository is a place to submit new NWB:N extension recipes, i.e., before a ndx-custom-recipe repo exists for the extension.

#### 2.2.3 ndx-custom-recipe: Custom extension catalog recipe

The NDX Catalog contains a collection of ndx-custom-recipes created by the creators of the extensions. See below for further details.


### 2.3 Custom Extension Code Repositories

#### 2.3.1 ndx-custom-recipe: Custom extension catalog recipe

The ndx-custom-recipe is created from the staged-extensions repository as part of the NDX catalog and MUST have the same name as the main namespace of the NDX. This strategy helps ensure that there are no name conflicts between public NDX namespace names.  The ndx-custom-recipy  repository MUST contain the following:

* **/** : root directory of the repo
   * **/ndx-meta.yaml**: REQUIRED YAML file with the metadata describing the extensions. The YAML file MUST contain a dict with the following keys:
      * **src: <URL>** : URL to the public repository with the sources of the extension
      * **pip: <URL>** : URL for installing the extensions from PyPi
   * **/README.(md|rst)** : REQUIRED readme with basic description of the extension, badges for CI, install instructions etc.
   * **/.gitignore**: Containing standard ignore options to ignore sphinx build files, autogenerated docs files from the nwb-docutils and sphinx, python and matlab temporary files, etc.

In addition the ndx-custom-recipy may contain the following OPTIONAL documents related to the review of the extensions:

   * **/review**: OPTIONAL folder with GitHub Markdown (or RST documents) related to the review of the extension for acceptance as part of the NWB:N core schema.
      * If present the /review folder MUST contain:
          * **/review/README.md** : Readme file with instructions on how to build and use the review docs and for linking all the documents together.
          * **/review/RELEASE_NOTES.md** : Markdown file with the release notes for the review docs. This file MUST be linked to from README.md.
          * **/review/REVIEW.md** : Main document with the review discussion for the NDX. This file MUST be linked to from README.md.
      * In addition the folder MAY contain the following SUGGESTED documentation files:
            * **/review/CREDITS.md** : Markdown file with the credits for the extension review. If present, the file MUST be linked to from the README.md.
            * **/review/LEGAL.md** : Markdown file with the legal details about the extension review (e.g., licence and copyright). If present, the file MUST be linked to from the README.md.

#### 2.3.2 ndx-custom: Custom NWB:N Extensions
The ndx-custom repository contains the sources of the user extension that has usually been created from the ndx-template. This repository lives in the users own Git space and is NOT part of the nwb-extensions organization.

### 2.4 Additional Tools and Methods

#### 2.4.1 Documenting extensions

The [nwb-docutils](https://github.com/NeurodataWithoutBorders/nwb-docutils) provide tools for generating Sphinx RST documentation directly from the YAML sources. The “generate_format_docs.py” command-line tools MUST be used to auto-generate documentation from the YAML sources.

As part of the ndx-template Git repository NWB:N provides a standard setup for generating Sphinx documentation for extension based on the nwb-docutils. Extensions MAY customize the documentation but MUST follow the standard for building and generating the extensions.

#### 2.4.2 Creating extension specifications

Extensions SHOULD be created using the PyNWB specification API to improve maintainability of the extensions and to insulate the creators of the extensions from low-level details of the NWB:N specification language (see the PyNWB [docs](https://pynwb.readthedocs.io/en/stable/extensions.html) and [tutorial](https://pynwb.readthedocs.io/en/stable/tutorials/general/extensions.html#sphx-glr-tutorials-general-extensions-py) for details). The sources for creating the extensions SHOULD be shared along with the extension YAML specification files to facilitate maintenance and compliance with the NWB:N specification language. Extensions MAY also be created by just sharing YAML files (e.g., written by hand) that are compliant with the NWB:N specification language, however, this is NOT RECOMMENDED.


## 3. Extension process (create, deploy, update)

The figure below illustrates the process for (1) creating a new extensions, (2) creating a recipe to register an extension with the extension catalog, and (3) to update an extension/recipe. The figure also illustrates the automated CI processes that are managed in the [nwb-extensions](https://github.com/nwb-extensions) catalog. The catalog process is modeled after the conda-forge model, enabling us to largely automate the catalog process using free, public services and avoiding the need to host our own services.

<img alt="NDX Catalog Logo" src="images/nwbn_extension_catalog_workflow.png" width="800" class="center-block">

### 3.1 Continuous Integration (CI) for Extensions

This can be separated in CI for three main repositories:

1. the staged-extensions repository as part of the nwb-extensions catalog,
1. the ndx-custom-recipe repo as part of the nwb-extensions catalog,  and
1. the users ndx-custom repository.

Part 1 and 2 are part of the nwb-extensions catalog and are maintained by the NWB:N development team. Part 3 will need to be setup and maintained by the extension developers. The ndx-template can provide templates for defining CI for ndx-custom repositories, but ultimately this will be up to the extension developers to do.

#### 3.1.1 staged-extensions CI

For the staged-extensions repositories we have common tests to validate basic compliance and working order of the extensions before creating the ndx-custom-recipe repo. Here we can test, e.g., the extensions metadata, i.e., are all required fields for the catalog specified and valid.

#### 3.1.2 ndx-custom-recipe CI

Similar to the staged-extensions, we can provide CI for ndx-custom-recipe repositories to automatically test compliance and working order of the extensions before merging pull requests. Here we can test, e.g., the extensions metadata, i.e., are all required fields for the catalog specified and valid.

#### 3.1.3 ndx-custom CI

Here we can provide example configuration files and instructions as part of the ndx-template repository but ultimately this is up to the user to setup and maintain. The ndx-template repo itself will likely not include CI itself. However, it includes templates for setting up CI for ndx-custom user extension repositories. See the [ndx-template](https://github.com/nwb-extensions/ndx-template) repo for details. We generally recommend to use CI to:

* Run unit tests (on all platforms) for API classes for the extension (and measure test coverage)
* Flake8 to ensure compliance with coding guidelines
* Test that YAML specification is compliant with the specification language
* Test that sphinx documents (and galleries) can be built








